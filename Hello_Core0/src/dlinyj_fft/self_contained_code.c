
#include "../Hello_Core0.h"
#ifdef PROJ_dlinyj_fft

/*                                                                                                                                         * Ã�Å¸Ã�ÂµÃ‘â‚¬Ã�ÂµÃ�Â½Ã�Â¾Ã‘ï¿½Ã�Â¸Ã�Â¼Ã�Â°Ã‘ï¿½ Ã‘â‚¬Ã�ÂµÃ�Â°Ã�Â»Ã�Â¸Ã�Â·Ã�Â°Ã‘â€ Ã�Â¸Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â´Ã�Â»Ã‘ï¿½ Ã�Â¿Ã‘â‚¬Ã�Â¾Ã‘â€ Ã�ÂµÃ‘ï¿½Ã‘ï¿½Ã�Â¾Ã‘â‚¬Ã�Â¾Ã�Â² Ã‘ï¿½Ã‘â€šÃ�Â°Ã�Â½Ã�Â´Ã�Â°Ã‘â‚¬Ã‘â€šÃ�Â½Ã�Â¾Ã�Â¹ Ã�Â°Ã‘â‚¬Ã‘â€¦Ã�Â¸Ã‘â€šÃ�ÂµÃ�ÂºÃ‘â€šÃ‘Æ’Ã‘â‚¬Ã‘â€¹                                                                      * Ã�â€™Ã�ÂµÃ‘â‚¬Ã‘ï¿½Ã�Â¸Ã‘ï¿½: 0.2b
 * Ã�Â¤Ã�Â°Ã�Â¹Ã�Â»: "fft.h"
 * Ã�Å¡Ã�Â¾Ã�Â´Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�ÂºÃ�Â°: UTF-8
 * Ã�ï¿½Ã�Â²Ã‘â€šÃ�Â¾Ã‘â‚¬Ã‘â€¹: Ã�â€�Ã�Â¼Ã�Â¸Ã‘â€šÃ‘â‚¬Ã�Â¸Ã�Â¹ Ã�Â¡Ã‘Æ’Ã‘ï¿½Ã�Â»Ã‘ï¿½Ã�ÂºÃ�Â¾Ã�Â², Ã�ï¿½Ã�Â»Ã�ÂµÃ�ÂºÃ‘ï¿½Ã�Â°Ã�Â½Ã�Â´Ã‘â‚¬ Ã�â€œÃ‘â‚¬Ã�Â¸Ã�Â½Ã‘Å’Ã�ÂºÃ�Â¾Ã�Â²                                                                                            * Ã�â€�Ã�Â°Ã‘â€šÃ�Â° Ã�Â¼Ã�Â¾Ã�Â´Ã�Â¸Ã‘â€žÃ�Â¸Ã�ÂºÃ�Â°Ã‘â€ Ã�Â¸Ã�Â¸: 2011.11.23
 */

#ifndef FFT_H
#define FFT_H
#define M_PI 3.14159265358979323846
//----------------------------------------------------------------------------
// Ã�Â¾Ã�Â¿Ã‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â¾Ã‘â€šÃ�Â»Ã�Â°Ã�Â´Ã�Â¾Ã‘â€¡Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¿Ã�ÂµÃ‘â€¡Ã�Â°Ã‘â€šÃ�Â¸ Ã�Â½Ã�Â° stderr
#define FFT_DEBUG // FIXME
//----------------------------------------------------------------------------
#ifdef FFT_DEBUG
#  include <stdio.h> // fprintf()
#  ifdef FFT_WIN32
#    define FFT_DBG(fmt, ...) fprintf(stderr, "RK: " fmt "\n", __VA_ARGS__)
#  else
#    define FFT_DBG(fmt, arg...) fprintf(stderr, "RK: " fmt "\n", ## arg)
#  endif
#else
#  ifdef FFT_WIN32
#    define FFT_DBG(fmt, ...)
#  else
#    define FFT_DBG(fmt, arg...)
#  endif
#endif // FFT_DEBUG
//---------------------------------------------------------------------------
// inline macro
#ifndef FFT_INLINE
#  if __GNUC__
#    define FFT_INLINE static inline
#  else
#    define FFT_INLINE inline
#  endif
#endif // FFT_INLINE
//---------------------------------------------------------------------------
#ifdef __cplusplus
extern "C" {
#endif // __cplusplus
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã‘â‚¬Ã�Â°Ã‘ï¿½Ã‘â€¡Ã‘â€˜Ã‘â€šÃ�Â° Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤
void fft_make(
  int p,     // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  float *c); // Ã‘â‚¬Ã�ÂµÃ�Â·Ã‘Æ’Ã�Â»Ã‘Å’Ã‘â€šÃ�Â¸Ã‘â‚¬Ã‘Æ’Ã‘Å½Ã‘â€°Ã�Â¸Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ c[1 << p]
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã‘â‚¬Ã�Â°Ã‘ï¿½Ã‘â€¡Ã‘â€˜Ã‘â€šÃ�Â° Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�Â´Ã�Â»Ã‘ï¿½ Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤
void fft_make_reverse(
  int p,     // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  float *c); // Ã‘â‚¬Ã�ÂµÃ�Â·Ã‘Æ’Ã�Â»Ã‘Å’Ã‘â€šÃ�Â¸Ã‘â‚¬Ã‘Æ’Ã‘Å½Ã‘â€°Ã�Â¸Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ c[1 << p]
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â±Ã�Â¸Ã�Â½Ã�Â°Ã‘â‚¬Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¸Ã�Â½Ã�Â²Ã�ÂµÃ‘â‚¬Ã‘ï¿½Ã�Â¸Ã�Â¸ Ã�Â¸Ã�Â½Ã�Â´Ã�ÂµÃ�ÂºÃ‘ï¿½Ã�Â°
FFT_INLINE int fft_binary_inversion(
  int p, // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  int i) // Ã�Â¸Ã‘ï¿½Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã‘â€¹Ã�Â¹ Ã�Â¸Ã�Â½Ã�Â´Ã�ÂµÃ�ÂºÃ‘ï¿½ [0, (1 << p) - 1]
{
  int j = 0;
  while (p-- > 0)
  {
    j <<= 1;
    j |= i & 1;
    i >>= 1;
  }
  return j;
}
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â¿Ã‘â‚¬Ã‘ï¿½Ã�Â¼Ã�Â¾Ã�Â³Ã�Â¾ Ã�â€˜Ã�Å¸Ã�Â¤
void fft_calc(
  int p,           // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  const float *c,  // Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�â€˜Ã�Å¸Ã�Â¤
  const float *in, // Ã�Â²Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  float *out,      // Ã�Â²Ã‘â€¹Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  int norm);       // Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â·Ã�Â½Ã�Â°Ã�Âº Ã�Â½Ã�Â¾Ã‘â‚¬Ã�Â¼Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�ÂºÃ�Â¸
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â¾Ã�Â±Ã‘â‚¬Ã�Â°Ã‘â€šÃ�Â½Ã�Â¾Ã�Â³Ã�Â¾ Ã�â€˜Ã�Å¸Ã�Â¤
FFT_INLINE void fft_calc_reverse(
  int p,           // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  const float *c,  // Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤
  const float *in, // Ã�Â²Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  float *out,      // Ã�Â²Ã‘â€¹Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  int norm)        // Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â·Ã�Â½Ã�Â°Ã�Âº Ã�Â½Ã�Â¾Ã‘â‚¬Ã�Â¼Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�ÂºÃ�Â¸
{
  fft_calc(p, c, in, out, !norm); // Ã�â€˜Ã�Å¸Ã�Â¤
}
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â¿Ã�ÂµÃ‘â‚¬Ã�ÂµÃ‘ï¿½Ã‘â€šÃ�Â°Ã�Â½Ã�Â¾Ã�Â²Ã�ÂºÃ�Â¸ Ã�Â¾Ã‘â€šÃ‘ï¿½Ã‘â€¡Ã‘â€˜Ã‘â€šÃ�Â¾Ã�Â² Ã‘ï¿½Ã�Â¿Ã�ÂµÃ�ÂºÃ‘â€šÃ‘â‚¬Ã�Â° (Ã‘â€¡Ã‘â€šÃ�Â¾ Ã�Â±Ã‘â€¹ "0" Ã�Â² Ã‘â€ Ã�ÂµÃ�Â½Ã‘â€šÃ‘â‚¬Ã�Âµ)
void fft_shift(
  int p,        // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  float *data); // Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã‘ï¿½Ã�Â»Ã�Âµ Ã�â€˜Ã�Å¸Ã�Â¤
//----------------------------------------------------------------------------
#ifdef __cplusplus
}
#endif // __cplusplus
//----------------------------------------------------------------------------
#endif // FFT_H

/*** end of "fft.h" file ***/
#include <stdlib.h>
#include <string.h>
#include <stdio.h>
#include <math.h>

//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã‘â‚¬Ã�Â°Ã‘ï¿½Ã‘â€¡Ã‘â€˜Ã‘â€šÃ�Â° Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤
void fft_make(
  int p,    // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  float *c) // Ã‘â‚¬Ã�ÂµÃ�Â·Ã‘Æ’Ã�Â»Ã‘Å’Ã‘â€šÃ�Â¸Ã‘â‚¬Ã‘Æ’Ã‘Å½Ã‘â€°Ã�Â¸Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ c[1 << p]
{
  int n, i;
  float w, f;
  n = 1 << p; // Ã‘â‚¬Ã�Â°Ã�Â·Ã�Â¼Ã�ÂµÃ‘â‚¬ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²Ã�Â° (Ã‘â€¡Ã�Â¸Ã‘ï¿½Ã�Â»Ã�Â¾ Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã�â€˜Ã�Å¸Ã�Â¤)
  w = (2. * M_PI) / (float) n;
  f = 0.;
  for (i = 0; i < n; i++)
  {
    *c++ =  cos(f);
    *c++ = -sin(f);
    f += w;
  }
}
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã‘â‚¬Ã�Â°Ã‘ï¿½Ã‘â€¡Ã‘â€˜Ã‘â€šÃ�Â° Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�Â´Ã�Â»Ã‘ï¿½ Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤
void fft_make_reverse(
  int p,    // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  float *c) // Ã‘â‚¬Ã�ÂµÃ�Â·Ã‘Æ’Ã�Â»Ã‘Å’Ã‘â€šÃ�Â¸Ã‘â‚¬Ã‘Æ’Ã‘Å½Ã‘â€°Ã�Â¸Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ c[1 << p]
{
  int n, i;
  float w, f;
  n = 1 << p; // Ã‘â‚¬Ã�Â°Ã�Â·Ã�Â¼Ã�ÂµÃ‘â‚¬ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²Ã�Â° (Ã‘â€¡Ã�Â¸Ã‘ï¿½Ã�Â»Ã�Â¾ Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã�Å¾Ã�â€˜Ã�Å¸Ã�Â¤)
  w = (2. * M_PI) / (float) n;
  f = 0.;
  for (i = 0; i < n; i++)
  {
    *c++ = cos(f);
    *c++ = sin(f);
    f += w;
  }
}
//----------------------------------------------------------------------------
// Ã‘â€žÃ‘Æ’Ã�Â½Ã�ÂºÃ‘â€ Ã�Â¸Ã‘ï¿½ Ã�Â¿Ã‘â‚¬Ã‘ï¿½Ã�Â¼Ã�Â¾Ã�Â³Ã�Â¾ Ã�â€˜Ã�Å¸Ã�Â¤
void fft_calc(
  int p,           // Ã�Â¿Ã�Â¾Ã�ÂºÃ�Â°Ã�Â·Ã�Â°Ã‘â€šÃ�ÂµÃ�Â»Ã‘Å’ Ã�Â´Ã�Â²Ã�Â¾Ã�Â¹Ã�ÂºÃ�Â¸ (Ã�Â½Ã�Â°Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â¼Ã�ÂµÃ‘â‚¬, Ã�Â´Ã�Â»Ã‘ï¿½ Ã�â€˜Ã�Å¸Ã�Â¤ Ã�Â½Ã�Â° 256 Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã‘ï¿½Ã‘â€šÃ�Â¾ 8)
  const float *c,  // Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² Ã�Â¿Ã�Â¾Ã�Â²Ã�Â¾Ã‘â‚¬Ã�Â¾Ã‘â€šÃ�Â½Ã‘â€¹Ã‘â€¦ Ã�Â¼Ã�Â½Ã�Â¾Ã�Â¶Ã�Â¸Ã‘â€šÃ�ÂµÃ�Â»Ã�ÂµÃ�Â¹ Ã�â€˜Ã�Å¸Ã�Â¤
  const float *in, // Ã�Â²Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  float *out,      // Ã�Â²Ã‘â€¹Ã‘â€¦Ã�Â¾Ã�Â´Ã�Â½Ã�Â¾Ã�Â¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²
  int norm)        // Ã�Â¿Ã‘â‚¬Ã�Â¸Ã�Â·Ã�Â½Ã�Â°Ã�Âº Ã�Â½Ã�Â¾Ã‘â‚¬Ã�Â¼Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�ÂºÃ�Â¸
{
  int i;
  int n = 1 << p;  // Ã‘â€¡Ã�Â¸Ã‘ï¿½Ã�Â»Ã�Â¾ Ã‘â€šÃ�Â¾Ã‘â€¡Ã�ÂµÃ�Âº Ã�â€˜Ã�Å¸Ã�Â¤
  int n2 = n >> 1; // n/2
  float re, im, re1, im1, re2, im2; // c, c1, c2
  float *p1, *p2;
  const float *p0;

  // Ã�ÂºÃ�Â¾Ã�Â¿Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�Â°Ã‘â€šÃ‘Å’ Ã‘ï¿½Ã�Â»Ã�ÂµÃ�Â¼Ã�ÂµÃ�Â½Ã‘â€šÃ‘â€¹ Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â²Ã�Â° `in` Ã�Â² Ã�Â¼Ã�Â°Ã‘ï¿½Ã‘ï¿½Ã�Â¸Ã�Â² `out` Ã‘ï¿½ Ã�Â±Ã�Â¸Ã‘â€šÃ�Â¾Ã�Â²Ã�Â¾Ã�Â¹ Ã�Â¸Ã�Â½Ã�Â²Ã�ÂµÃ‘â‚¬Ã‘ï¿½Ã�Â¸Ã�ÂµÃ�Â¹
  for (i = 0; i < n; i++)
  {
    int j = fft_binary_inversion(p, i) << 1;
    int k = i << 1;

    p0 = in  + j;
    p1 = out + k;
    *p1++ = *p0++; // out[i] = in[j]
    *p1   = *p0;   //

    p0 = in  + k;
    p1 = out + j;
    *p1++ = *p0++; // out[j] = in[i]
    *p1   = *p0;   //
  }

  // Ã�Â²Ã‘â€¹Ã�Â¿Ã�Â¾Ã�Â»Ã�Â½Ã�ÂµÃ�Â½Ã�Â¸Ã�Âµ Ã�Â±Ã�Â°Ã�Â±Ã�Â¾Ã‘â€¡Ã�ÂµÃ�Âº ("Ã�Â¿Ã�Â¾Ã�Â½Ã�ÂµÃ‘ï¿½Ã�Â»Ã�Â°Ã‘ï¿½Ã‘Å’ Ã�Â´Ã‘Æ’Ã‘Ë†Ã�Â° Ã�Â² Ã‘â‚¬Ã�Â°Ã�Â¹" (C) Hokum)
  for (i = 0; i < p; i++)
  {
    int m = 1 << (i + 1); // Ã‘â€¡Ã�ÂµÃ‘â‚¬Ã�ÂµÃ�Â· Ã‘ï¿½Ã�ÂºÃ�Â¾Ã�Â»Ã‘Å’Ã�ÂºÃ�Â¾ Ã‘ï¿½Ã�Â»-Ã‘â€šÃ�Â¾Ã�Â² Ã�Â±Ã�Â°Ã�Â±Ã�Â¾Ã‘â€¡Ã�ÂºÃ�Â° * 2
    int r = m << 1;       // Ã‘â‚¬Ã�Â°Ã�Â·Ã�Â¼Ã�ÂµÃ‘â‚¬ Ã�Â³Ã‘â‚¬Ã‘Æ’Ã�Â¿Ã�Â¿Ã‘â€¹ * 2
    int nom = 0;          // Ã�Â½Ã�Â¾Ã�Â¼Ã�ÂµÃ‘â‚¬ Ã�Â³Ã‘â‚¬Ã‘Æ’Ã�Â¿Ã�Â¿Ã‘â€¹ * r
    int k = 0;            // Ã�Â½Ã�Â¾Ã�Â¼Ã�ÂµÃ‘â‚¬ Ã‘ï¿½Ã�Â»-Ã‘â€šÃ�Â° Ã�Â² Ã�Â³Ã‘â‚¬Ã‘Æ’Ã�Â¿Ã�Â¿Ã�Âµ * 2
    int y = 0;            // Ã�Â¸Ã�Â½Ã�Â´Ã�ÂµÃ�ÂºÃ‘ï¿½ W * 2
    int z = 0;
    int h = 1 << (p - i); // Ã‘Ë†Ã�Â°Ã�Â³ Ã�Â´Ã�Â»Ã‘ï¿½ W * 2
    int j;

    for (j = n2; j > 0; j--)
    {
      if (k >= m)
      {
        k = y = 0;
        nom += r;
        z = nom;
      }

      // c <= c[y]
      p0 = c + y;
      re = *p0++;
      im = *p0;

      // c2 <= out[z + m]
      p1  = out + (z + m);
      re2 = *p1++;
      im2 = *p1;

      // c1 <= c2 * c
      re1 = re2 * re - im2 * im;
      im1 = im2 * re + re2 * im;

      // c2 <= out[z]
      p2  = out + z;
      re2 = *p2++;
      im2 = *p2;

      // out[z]     <= c2 + c1
      // out[z + m] <= c2 - c1
      *p2-- = im2 + im1;
      *p1-- = im2 - im1;
      *p2   = re2 + re1;
      *p1   = re2 - re1;

      k += 2;
      z += 2;
      y += h;
    }
  }

  if (norm)
  { // Ã�Â½Ã�Â¾Ã‘â‚¬Ã�Â¼Ã�Â¸Ã‘â‚¬Ã�Â¾Ã�Â²Ã�ÂºÃ�Â°
    re = 1. / ((float) n);
    p1 = out;
    for (i = n; i > 0; i--)
    {
      *p1++ *= re;
      *p1++ *= re;
    }
  }
}
#endif
